<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Web 安全 | Frontend-Learning</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="https://vuepress-theme-reco.recoluan.com/favicon.ico">
    <meta name="description" content="前端面试八股文">
    
    <link rel="preload" href="/Vuepress-Frontend-Learning/assets/css/0.styles.4c119140.css" as="style"><link rel="preload" href="/Vuepress-Frontend-Learning/assets/js/app.124d66d7.js" as="script"><link rel="preload" href="/Vuepress-Frontend-Learning/assets/js/3.d90bb6d0.js" as="script"><link rel="preload" href="/Vuepress-Frontend-Learning/assets/js/1.2c4ca2ac.js" as="script"><link rel="preload" href="/Vuepress-Frontend-Learning/assets/js/81.b9714d74.js" as="script"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/10.3fb81d5f.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/11.bc5467f7.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/12.60e337b9.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/13.b8d6dea2.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/14.daf9d5e4.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/15.a2a94f85.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/16.0209810e.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/17.084fd80a.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/18.b5c5535b.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/19.78473768.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/20.b9c712bc.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/21.de171f7c.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/22.79481907.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/23.9a197710.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/24.cc469eb7.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/25.adfb7b53.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/26.218324b5.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/27.c7dd9602.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/28.86e37003.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/29.03d6900a.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/30.d05abd8b.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/31.f86df942.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/32.44be1a33.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/33.a0c5c185.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/34.68ad8134.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/35.2ecbc6ef.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/36.9a5f1bbb.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/37.89a54f06.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/38.27def364.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/39.53360cbd.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/4.8b752032.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/40.afd965c8.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/41.53936f76.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/42.99fcb1e2.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/43.6dcfc2b5.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/44.bc77aabc.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/45.2b134955.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/46.3c40e664.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/47.558416f2.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/48.4c08a221.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/49.9768537a.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/5.8873caea.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/50.f973d82e.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/51.7674f117.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/52.24705c78.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/53.2cf3c656.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/54.69e2b970.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/55.0eefdd3e.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/56.a1a19c22.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/57.5a5bc7bf.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/58.e5463bb9.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/59.d034b64a.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/6.c1f5de78.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/60.855a7005.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/61.31a32f38.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/62.00262306.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/63.6a3cad92.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/64.6370fc9b.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/65.77c5f2d0.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/66.c483cf9b.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/67.bed35887.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/68.a81bf5ae.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/69.fe57fd13.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/7.18d47045.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/70.ba58999a.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/71.50d883d5.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/72.78186c05.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/73.964c2de4.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/74.741ba5e3.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/75.ebfa227b.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/76.7be65790.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/77.5b8c0416.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/78.da5933f0.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/79.442aad7c.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/8.a3953fde.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/80.ba5fb99f.js"><link rel="prefetch" href="/Vuepress-Frontend-Learning/assets/js/9.91ba2d4a.js">
    <link rel="stylesheet" href="/Vuepress-Frontend-Learning/assets/css/0.styles.4c119140.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Frontend-Learning</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>前端面试八股文</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2021
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Vuepress-Frontend-Learning/" class="home-link router-link-active"><!----> <span class="site-name">Frontend-Learning</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-39576ba9 data-v-1aefc0b4><!----> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>69</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <!----> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/Vuepress-Frontend-Learning/" class="sidebar-heading clickable router-link-active"><span>关于</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Vuepress-Frontend-Learning/CSS/Pseudo" class="sidebar-heading clickable"><span>CSS 基础知识</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Vuepress-Frontend-Learning/JavaScript/DataTypes/Intro" class="sidebar-heading clickable"><span>JavaScript 基础知识</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Vuepress-Frontend-Learning/HandWriting/Utils/ArrayDuplicate" class="sidebar-heading clickable"><span>JavaScript 手写系列</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Vuepress-Frontend-Learning/Project/Module" class="sidebar-heading clickable"><span>前端工程化</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Vuepress-Frontend-Learning/Browser/JS" class="sidebar-heading clickable"><span>浏览器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Vuepress-Frontend-Learning/Protocol/DNS" class="sidebar-heading clickable"><span>网络协议</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Vuepress-Frontend-Learning/WebSecurity/CrossDomain" class="sidebar-heading clickable open"><span>安全</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Vuepress-Frontend-Learning/WebSecurity/CrossDomain.html" class="sidebar-link">跨域通信</a></li><li><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html" aria-current="page" class="active sidebar-link">Web 安全</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/Vuepress-Frontend-Learning/Performance/Performance" class="sidebar-heading clickable"><span>性能优化</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Web 安全</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2021
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><section><div class="page-title"><h1 class="title">Web 安全</h1> <div data-v-f875f3fc><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="跨域和跨站的区别"><a href="#跨域和跨站的区别" class="header-anchor">#</a> 跨域和跨站的区别</h2> <p>涉及到 Web 安全，会有一个跨站的概念，跨站和跨域是不同的。</p> <h3 id="跨域"><a href="#跨域" class="header-anchor">#</a> 跨域</h3> <p>跨域即 cross-domain，它和同源（same-origin）相对，要求两个 URL 的协议、端口号、域名都一致才能称为同源。</p> <blockquote><p>如何判断是否跨域？</p></blockquote> <p>判断是否跨域很简单，只需要判断两个 URL 的协议、端口、域名是否完全一致即可。</p> <h3 id="跨站"><a href="#跨站" class="header-anchor">#</a> 跨站</h3> <p>跨站即 cross-site，它和同站（same-site）相对，对协议和端口号无要求，只要两个 URL 的 <code>eTLD + 1</code> 一致，就能称为同站。那么什么是 <code>eTLD</code> 呢？</p> <p><code>eTLD</code> 即 effective top level domain，有效顶级域名，比如 <code>http://juejin.cn</code>  的 <code>eTLD</code> 是 <code>.cn</code>，<code>http://test.org</code> 的 <code>eTLD</code> 是 <code>.org</code>，而 <code>http://chorer.github.io</code> 则是 <code>github.io</code>（注意不是 <code>.io</code>）。而 <code>eTLD + 1</code>  指的是有效顶级域名 + 二级域名，比如对于 <code>http://juejin.cn</code> 来说就是 <code>juejin.cn</code>，对于 <code>http://test.org</code> 来说就是 <code>test.org</code>。</p> <p><strong>PS：</strong> 不过需要注意的是，same-site 实际上也分为两种，一种是上面定义的协议松散型 same-site，即 scheme-less same-site，在判断是否同站时并不需要考虑协议；另一种则是协议严格型 same-site，即 schemeful same-site，要求协议必须一致才能认定为是同站。</p> <blockquote><p>如何判断是否跨站？</p></blockquote> <p>判断是否跨站并没有那么简单，对于给定的一个 URL，其实我们有时候是很难直接看出它的 eTLD 的。Mozilla 维护了一个公共后缀列表，里面存放了超过 9000 条 eTLD，有时候需要对照这个表才能查找 eTLD。</p> <h2 id="xss"><a href="#xss" class="header-anchor">#</a> XSS</h2> <p>XSS 即 Cross-Site Scripting（跨站脚本攻击），指的是黑客将恶意代码注入页面中，只要打开页面，代码就会执行。XSS 攻击可能导致 Cookie 被窃取、个人信息泄露、劫持流量实现恶意跳转等。</p> <h3 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h3> <p>XSS 基本可以分为两类，一个是反射型 XSS（非持久型 XSS），一个是存储型 XSS（持久型 XSS）。</p> <p><strong>反射型 XSS</strong></p> <p>黑客诱导用户点击带有特殊参数的 URL，从而往页面中注入恶意代码。比如说，正常向服务器发起请求的 URL 是 <code>http://test.com?name=jack</code>，服务器拿到参数 <code>jack</code> 之后，不做处理，直接返回一个响应 <code>Hello jack</code>，HTML 是这样的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Hello jack<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样当然没问题，但如果用户点击了黑客的 URL 是 <code>http://test.com?name=&lt;script&gt;alert(1)&lt;/script&gt;</code>，那么服务器拿到了 <code>name</code> 参数，如果不做处理就返回响应，HTML 会是这样的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>那么解析 HTML 的时候，实际上是会执行中间这段脚本的。<code>alert(1)</code> 只是一个示例 —— 这里可以是任何的脚本操作，包括通过 <code>document.cookie</code> 窃取用户 Cookie，通过 <code>window.location</code> 实现跳转等，会有很大的安全风险。</p> <p><strong>存储型 XSS</strong></p> <p>存储型 XSS 是持久的，而且风险会更大，因为恶意代码会存储到数据库中，无论哪个用户访问页面，都会被波及。比如说，黑客给某篇文章的评论区留言，写下 <code>&lt;script&gt;alert(1)&lt;/script&gt;</code>，之后提交表单给服务器。服务器不做任何处理，只是把留言存储到数据库中。下次无论哪位用户访问这篇文章，服务器都会从数据库中获取留言并返回给浏览器，这当然也包括了 <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> ，只要一执行就会产生弹窗，对于所有用户都是如此。同样，这里弹窗只是一个举例，它可以是任何危害到用户信息安全的脚本操作。</p> <h3 id="防御措施"><a href="#防御措施" class="header-anchor">#</a> 防御措施</h3> <p><strong>1）HTML 转义</strong></p> <blockquote><p><code>&lt;</code> 用于定义标签的开始，如果我们希望浏览器确实显示 <code>&lt;</code> 这个字符本身，而不是把它当作一个标签去解析，那么就必须对字符进行转义（escape），编写字符实体而不是字符。</p></blockquote> <p>同理，为了安全起见，我们不应该把 <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> 作为标签去解析，而只是希望它是一个单纯的字符串，所以可以考虑在服务端这边进行 HTML 转义：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token entity named-entity" title="&lt;">&amp;lt;</span>script<span class="token entity named-entity" title="&gt;">&amp;gt;</span>alert(1)<span class="token entity named-entity" title="&lt;">&amp;lt;</span>/script<span class="token entity named-entity" title="&gt;">&amp;gt;</span>
</code></pre></div><p>这个转义的结果最终返回给浏览器， <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> 会作为字符串在页面上显示出来，而不再是可执行的脚本。</p> <p><strong>2）用户输入验证</strong></p> <p>转义指的是对 <code>&lt;</code>、<code>&gt;</code>等特殊字符进行转义，如果说注入的恶意脚本都是用 <code>&lt;script&gt;&lt;/script&gt;</code>包裹的，那么 HTML 转义确实可以避免 XSS 攻击 —— 但实际上，有其他的方式可以进行脚本注入。比如某社区网站允许用户在个人资料中填写自己博客的地址，并最终作为 <code>&lt;a href=&quot;xxx&quot;&gt;我的博客地址&lt;/a&gt;</code>展示出来，那么别有用心的黑客就可以填入 <code>javascript:alert(1);</code>，这是不会经过 HTML 转义的，因此最终黑客的博客地址是这样的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:alert(1);<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>这是用户博客的地址<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>只要有人点击查看他资料中的博客地址，就会发生弹窗。</p> <p>同样的，如果网站还允许用户通过填写 URL 的方式设置头像图片，并最终作为 <code>&lt;img src=&quot;xxx&quot;&gt;</code> 展示出来，那么黑客可以填入 <code>xxx&quot; onerror=&quot;alert(1)</code>，这同样是不会经过 HTML 转义的，因此最终 <code>img</code> 标签是这样的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xxx<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这里的 <code>src</code> 明显是不合法的，所以会触发 <code>error</code> 事件，发生弹窗。</p> <p>因此，单纯的 HTML 转义并不能规避所有 XSS 攻击，我们还必须对用户输入的数据进行验证。</p> <p><strong>3）CSP</strong></p> <p>CSP 即 Content  Security Policy（内容安全策略），开发者提供一个白名单，告诉浏览器只能加载特定来源的代码，从而禁止某些第三方脚本的运行。</p> <p>CSP 有两种使用方式：</p> <ul><li><p>服务端响应一个 <code>content-security-policy</code> 头部字段，约束浏览器的加载行为：</p> <div class="language-html extra-class"><pre class="language-html"><code>Content-Security-Policy: script-src 'self'; style-src cdn.example.org third-party.org; child-src https:
</code></pre></div></li> <li><p>HTML 中使用 <code>meta</code> 标签，约束浏览器的加载行为：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Content-Security-Policy<span class="token punctuation">&quot;</span></span> 
      <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>script-src <span class="token punctuation">'</span>self<span class="token punctuation">'</span>; style-src cdn.example.org third-party.org; child-src https:<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>它们的形式不同，但作用都是一样的：</p> <ul><li><code>script-src</code>：设置只允许加载哪些来源的脚本，设置为 <code>self</code> 代表只能加载本域名的脚本。注意它会禁止内联脚本的事件监听，比如前面例子的 <code>onerror</code>，使用的时候会报错提示违反了 CSP</li> <li><code>style-src</code>：设置只允许加载哪些来源的样式文件，这里只能加载 <code>cdn.example.org</code> 和 <code>third-party.org</code>的</li> <li><code>child-src</code>：设置为 <code>https</code> 表示必须使用 <code>https</code> 去加载 <code>iframe</code></li></ul></li></ul> <p><strong>4）HttpOnly</strong></p> <p>前面说过，黑客可以注入脚本窃取用户的 Cookie，这本质上是因为可以通过 <code>document.cookie</code> 去访问 Cookie，因此服务端可以在给客户端响应的 <code>Set-Cookie</code> 头部字段，声明一个 <code>HttpOnly</code> 来禁止通过脚本获取 Cookie。</p> <div class="language-js extra-class"><pre class="language-js"><code>Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> id<span class="token operator">=</span>a3fWa<span class="token punctuation">;</span> Expires<span class="token operator">=</span>Wed<span class="token punctuation">,</span> <span class="token number">21</span> Oct <span class="token number">2015</span> <span class="token number">07</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">GMT</span><span class="token punctuation">;</span> Secure<span class="token punctuation">;</span> HttpOnly
</code></pre></div><p><strong>5）Sanitizer API</strong></p> <p>Sanitizer API 是各大浏览器正在实现的一个原生 API。传统的转义方式存在一个缺点，那就是对于任意的 <code>&lt;</code> 和 <code>&gt;</code> 都会进行转义，比如：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>这里要作为标签渲染<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span>xxx<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这里其实只想要对 img 标签进行转义，因为其错误的路径会触发执行恶意脚本，但对于 em 标签，我们希望它正常作为标签去渲染。如果采用转义的方式，则 em 标签无法被渲染。</p> <p>所以 Sanitizer API 的思路是，对用户输入的字符串进行解析，并消除其中涉及到脚本执行的部分：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> sanitizer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sanitizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> user_input <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;em&gt;这里要作为标签渲染&lt;/em&gt;&lt;img src = &quot;xxx&quot; onerror=&quot;alert(1)&quot;&gt;</span><span class="token template-punctuation string">`</span></span>
sanitizer<span class="token punctuation">.</span><span class="token function">sanitizeFor</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>user_input<span class="token punctuation">)</span>

<span class="token comment">// 处理后的用户输入如下，脚本部分被消除了</span>
<span class="token comment">// &lt;em&gt;这里要作为标签渲染&lt;/em&gt;&lt;img src = &quot;xxx&quot;&gt;</span>
</code></pre></div><p>此外，Sanitizer API 本身提供了丰富的配置，可以定制更具体的消除规则。</p> <p>PS：目前 Sanitizer API 兼容性还很差，即使 Chrome 也只是一个实验特性，不过可以使用 DOMPurify 这样的库作为替代方案。</p> <h2 id="csrf"><a href="#csrf" class="header-anchor">#</a> CSRF</h2> <h3 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h3> <p>CSRF 即跨站请求伪造，黑客利用请求会携带 Cookie 的特点，冒充用户身份向正常网站发出请求，执行某些非法操作。它的作用过程大概是这样的：</p> <ul><li><p>用户登录 <code>http://article.com</code>，服务器验证通过，返回 Cookie 给浏览器保存</p></li> <li><p>假设 Cookie 没过期，这期间黑客诱导用户访问恶意网站 <code>http://evil.com</code>，这个网站中有这么一段代码：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://article/delete?id=1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>那么恶意网站就会向 <code>http://article.com</code> 发起一个携带 Cookie 的请求，服务端这边验证没问题，就会把 id 为 1 的文章给删除了</p></li></ul> <p>这里黑客之所以可以发起 CSRF 攻击，有下面几个原因：</p> <ul><li>用户：登录了正常网站且没有登出（Cookie 有效），之后访问了恶意网站</li> <li>黑客：知道执行请求的 URL 和所有的参数</li> <li>服务端：只使用 Cookie 进行权限验证，没有任何针对 CSRF 的防御措施</li> <li><code>img</code> 是支持跨域请求的。其实黑客也可以直接发送一个 AJAX 请求，不过由于同源策略和 CORS 的限制，<code>http://evil.com</code> 是无法向不同源的 <code>http://article.com</code> 发送请求的，所以黑客使用的是天然可以跨域的 <code>img</code> 标签</li></ul> <h3 id="xss-csrf"><a href="#xss-csrf" class="header-anchor">#</a> XSS + CSRF</h3> <p>上面的例子属于利用 Cookie 而不是窃取 Cookie，实际上，黑客可以先使用 XSS 拿到用户的 Cookie，接着再使用 CSRF 伪造发送请求。</p> <h3 id="防御措施-2"><a href="#防御措施-2" class="header-anchor">#</a> 防御措施</h3> <p>要制定防御措施，可以从 CSRF 产生的原因入手：</p> <ul><li>CSRF 大多来自第三方网站，若服务端能知道请求是谁发出的，并相应进行限制，那么可以在一定程度上规避攻击。与此相关的有 <code>SameSite</code> 属性、<code>Origin</code> 头部字段、<code>Referer</code> 头部字段</li> <li>CSRF 发生的关键在于第三方网站也能携带 Cookie 发送请求，导致服务端并不知道请求来自恶意网站还是正常用户。那么，我们可以让正常用户发送请求时携带一个恶意网站无法获取到的 token，服务端通过校验请求是否携带正确的 token，来把正常的请求和攻击的请求区分开，也可以防范 CSRF 攻击。与此相关的就是 <code>CSRF token</code>。</li></ul> <p><strong>同站限制 —— SameSite</strong></p> <blockquote><ul><li>==第一方 Cookie==：在 <code>http://bank.com</code> 下对 <code>http://bank.com/xxx</code> 发起请求，那么携带的 Cookie 是第一方 Cookie（由第一方携带的）；</li> <li>==第三方 Cookie==：在 <code>http://evil.com</code> 下对 <code>http://bank.com/xxx</code> 发起请求，携带的则是第三方 Cookie（由第三方携带的）。</li></ul></blockquote> <p>如果站点当初响应返回的 <code>Set-Cookie</code> 声明了非 none 的 <code>SameSite</code> 属性，那么该 Cookie 就会成为一个同站 Cookie，同站 Cookie 只会在同站请求之间携带，无法作为第三方 Cookie —— 换句话说，声明非 none 的 <code>SameSite</code> 可以避免在 <code>http://evil.com</code> 下对 <code>http://bank.com/xxx</code> 发起请求时携带 Cookie 过去，因此可以规避 CSRF 攻击。</p> <p>1）<code>Set-Cookie: SameSite = Strict</code>：</p> <p>这是最严格的模式，声明之后 Cookie 将不会在任何跨站请求中携带，也即完全禁用了第三方 Cookie，因此可以完全阻止 CSRF 攻击。但缺点是用户体验比较差：比如正常情况下，当前网页有一个跳转到目标网站的链接，点击进入后往往应该是登录状态，这是因为当前网页向目标网站发起的请求中携带了目标网站的 Cookie —— 而现在如果彻底禁用第三方 Cookie，就无法维持这个登录状态了，进入目标网站后需要重新登录。</p> <p>2）<code>Set-Cookie: SameSite = Lax</code>：</p> <p>Chrome80 之后采用的默认值。这种模式相对来说比较宽松，声明之后 Cookie 在大多数跨站请求的场景下仍然不会携带，因此保证了安全性；同时，<strong>导航到目标网站的 GET 请求</strong>（所谓的“顶级导航”，会引起地址栏 url 的改变）是可以携带 Cookie 的，因此保证了可用性（比如说维持登录态）。具体情况如下：</p> <table><thead><tr><th>请求类型</th> <th>示例</th> <th>正常情况</th> <th>Lax</th></tr></thead> <tbody><tr><td>链接</td> <td><code>&lt;a href=&quot;...&quot;&gt;&lt;/a&gt;</code></td> <td>发送 Cookie</td> <td>发送 Cookie</td></tr> <tr><td>预加载</td> <td><code>&lt;link rel=&quot;prerender&quot; href=&quot;...&quot;/&gt;</code></td> <td>发送 Cookie</td> <td>发送 Cookie</td></tr> <tr><td>GET 表单</td> <td><code>&lt;form method=&quot;GET&quot; action=&quot;...&quot;&gt;</code></td> <td>发送 Cookie</td> <td>发送 Cookie</td></tr> <tr><td>POST 表单</td> <td><code>&lt;form method=&quot;POST&quot; action=&quot;...&quot;&gt;</code></td> <td>发送 Cookie</td> <td>不发送</td></tr> <tr><td>iframe</td> <td><code>&lt;iframe src=&quot;...&quot;&gt;&lt;/iframe&gt;</code></td> <td>发送 Cookie</td> <td>不发送</td></tr> <tr><td>AJAX</td> <td><code>$.get(&quot;...&quot;)</code></td> <td>发送 Cookie</td> <td>不发送</td></tr> <tr><td>Image</td> <td><code>&lt;img src=&quot;...&quot;&gt;</code></td> <td>发送 Cookie</td> <td>不发送</td></tr></tbody></table> <p>表格的前三种都属于导航到目标网站的 GET 请求，这些请求虽然跨站但是可以携带 Cookie —— 尤其是第一种情况，允许我们通过外链到达目标网站后直接处于登录状态。</p> <p>3）<code>Set-Cookie: SameSite = None; Secure</code></p> <p>Chrome80 之前采用的默认值。这种模式可以关闭 <code>SameSite</code> 属性，不管是同站请求还是跨站请求，都会携带 Cookie。但与此同时，必须声明 <code>Secure</code>，让 Cookie 只能在 HTTPS 请求中携带。</p> <blockquote><p>PS：Chrome 将在 2022 年全面禁用第三方 Cookie</p></blockquote> <p><strong>同源检测 —— <code>Origin</code> 和 <code>Referer</code></strong></p> <p>服务端收到请求后，通常可以从请求报文的 <code>Origin</code> 或者 <code>Referer</code> 头部字段知道请求源，区别在于:</p> <p>出于安全考虑，有时候请求源并不希望把详细路径暴露给服务器，因此<code>Origin</code> 只给出域名信息：</p> <div class="language-js extra-class"><pre class="language-js"><code>Origin<span class="token operator">:</span> <span class="token string">'https://developer.mozilla.org'</span>
</code></pre></div><p>而 <code>Referer</code> 除了给出域名信息，还会给出具体路径：</p> <div class="language-js extra-class"><pre class="language-js"><code>Referer<span class="token operator">:</span> <span class="token string">'https://developer.mozilla.org/en-US/docs/Web/JavaScript'</span>
</code></pre></div><p>那么应该用哪一个呢？<code>Origin</code> 在 IE11 的 CORS 请求中不会携带，在 302 重定向的请求中也不会携带，所以更保险的是使用 <code>Referer</code> —— 但即便如此也要知道，在 HTTPS 页面跳转到 HTTP 页面的时候，出于安全考虑，不会携带 <code>Referer</code> 。</p> <p><strong>CSRF token</strong></p> <p>恶意网站进行 CSRF 攻击的一个必要条件是知道请求格式和参数，那么，如果让请求必须携带一个只有正常用户才知道的 token 作为参数，恶意网站就无法构造完整的请求了，也就无法进行攻击。</p> <blockquote><p>模式一：隐藏表单域 + session</p></blockquote> <ul><li><p>服务端生成一个随机的 CSRF token，存储在服务器的 session 中，同时下发 token 到用户的前端页面中。这里有两种情况</p> <p>一是将 token 注入到每个表单的隐藏的 <code>input</code> 域中：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>csrf-token<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CIwNZNlR4XbisJF39I8yWnWX9wX4WFoz<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>二是将 token 注入到 <code>meta</code> 标签中：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>csrf-token<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CIwNZNlR4XbisJF39I8yWnWX9wX4WFoz<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>前端若要发起 GET 请求，则通过 JS 获取 <code>meta</code> 中的 token，并作为请求 URL 的参数，形如 <code>http://test.com?csrftoken=CIwNZNlR4XbisJF39I8yWnWX9wX4WFoz</code> ；若要发起 POST 请求，则直接提交表单即可，之前注入到表单中的 token 会自动作为请求体的参数</p></li> <li><p>服务端拿到 GET 或者 POST 请求的 token 参数，与保存在 session 中的 token 比较，若相同则认为此次请求来自合法用户，否则认为来自恶意网站（恶意网站是拿不到 token 的，无法构造完整的请求）</p></li></ul> <blockquote><p>模式二：隐藏表单域 + cookie</p></blockquote> <ul><li>服务端生成一对互相关联的 CSRF token，一个 token 通过隐藏表单域下发到用户的前端页面中，另一个 token 注入到 <code>set-Cookie</code> 字段中</li> <li>前端提交表单发起 POST 请求，隐藏表单域中的 token 自动成为请求体的参数，<code>set-Cookie</code> 中的 token 则被放到请求头部字段 Cookie 中</li> <li>服务端对收到的两个 token 进行校验，校验通过则说明此次请求来自合法用户</li></ul> <p>PS：这种模式不需要服务端通过 session 维护大量的 token。虽然恶意网站还是可以在请求中携带 Cookie（内含 token），但是由于它拿不到服务端返回给用户的隐藏表单域（内含 token） ，因此它的请求参数是缺失的，实际上无法通过服务端的校验。</p> <p><strong>验证码</strong></p> <p>像删除数据这类敏感操作，如果不进行任何验证就直接执行操作，会有很大的风险。因此可以考虑使用验证码，但验证码应该只用于关键的业务节点中，滥用将会影响用户体验 —— 从这个角度来说，验证码更适合作为一个防御 CSRF 攻击的辅助手段。</p> <h2 id="clickjacking"><a href="#clickjacking" class="header-anchor">#</a> ClickJacking</h2> <p>ClickJacking 即点击劫持，指的是劫持用户的点击行为进行某些操作。</p> <p>比如说有一个恶意网站 <code>http://evil.com</code>，有一个正常网站 <code>http://funnyvideo.com</code>，恶意网站的网页下面是一个透明的、引用了正常网站的 <code>iframe</code>。黑客诱导用户进入恶意网站并在网页中进行点击，看起来用户只是在点击恶意网站的网页，但实际上是在点击正常网站的网页。</p> <h3 id="防御措施-3"><a href="#防御措施-3" class="header-anchor">#</a> 防御措施</h3> <p><strong><code>X-Frame-Options</code> 实现：</strong></p> <p>上述点击劫持发生的本质原因是恶意网站可以通过 <code>iframe</code> 引用正常网站，如果我们设法禁止通过 <code>iframe</code> 去引用正常网站，或者限制只有某些信任网站可以通过 <code>iframe</code> 引用正常网站，那么就可以规避点击劫持。响应头部字段 <code>X-Frame-Options</code> 就是来做这个事的，它可以设置下面的值：</p> <ul><li><code>deny</code>：禁止任何网站通过 <code>iframe</code> 引用正常网站</li> <li><code>sameorigin</code>：只允许同源网站通过 <code>iframe</code> 引用正常网站</li> <li><code>allow-from</code>：只允许特定网站通过 <code>iframe</code> 引用正常网站，比如 <code>allow-from http://test.com</code>，就表示 <code>http://test.com</code> 是受信任的，可以引用正常网站</li></ul> <p><strong>JS 实现：</strong></p> <p>对于某些不支持设置 <code>X-Frame-Options</code> 头部字段的旧浏览器，可以使用 js 作为一种 callback 的方案。</p> <ul><li><p>当 A 网站通过 <code>iframe</code> 引用 B 网站的时候，B 网站可以通过 <code>self</code> 获取自身 <code>window</code> 对象，通过 <code>top</code> 获取 A 网站的 <code>window</code> 对象，因此 B 网站可以使用 <code>top == self</code> 判断自身是否被其它网站通过 <code>iframe</code> 引用。</p></li> <li><p>同时，它还可以通过 <code>top.location.href</code> 获取引用自己的网站的 URL，据此可以通过模式匹配实现网站过滤，只允许信任的网站引用自己。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>top <span class="token operator">!=</span> self<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span>
    style<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'html{display:none!important;}'</span>
    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span>
    top<span class="token punctuation">.</span>location <span class="token operator">=</span> self<span class="token punctuation">.</span>location
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <p>上面的代码处理方式比较粗糙，如果 <code>top</code> 不等于 <code>self</code>，说明有其它网站引用了自己，那么就隐藏自身的所有内容，同时让第三方网站跳转到自身。当然，可以修改代码实现类似于 <code>X-Frame-Options</code> 各个参数的效果。</p> <h2 id="中间人攻击"><a href="#中间人攻击" class="header-anchor">#</a> 中间人攻击</h2> <p>中间人攻击（Man-in-middle Attack）指的是，攻击者充当一个中间人的角色，与通信的两端分别创建独立的联系，对传输的数据进行劫持和篡改。整个会话被中间人操控，但通信的两端都以为是在和对方通信。中间人攻击发生的原因在于通信双方没有采用数字签名、数字证书等手段验证对方身份。</p> <p>以前面讲过的混合加密过程为例，如果发生中间人攻击，过程大概如下：</p> <ul><li>客户端发送请求，请求获取服务端的公钥。中间人拦截请求，并将请求转发给服务端</li> <li>服务端收到请求，生成一对公钥（服）和私钥（服），私钥（服）自己保管，公钥（服）发给中间人（服务端以为此时的中间人是客户端）</li> <li>中间人拿到公钥（服）。同时生成自己的一对公钥（中）和私钥（中），冒充服务端将公钥（中）发给客户端</li> <li>客户端收到公钥（中），生成会话密钥（客），用公钥（中）加密会话密钥（客），然后发给中间人（客户端以为此时的中间人是服务端）</li> <li>中间人用私钥（中）解密，得到会话密钥（客）。同时生成自己的会话密钥（中），用公钥（服）加密之后发给服务端</li> <li>服务端收到，用私钥（服）解密，拿到会话密钥（中），以为这是客户端发来的会话密钥（客），于是用这个会话密钥加密数据 XXX，发送给中间人</li> <li>中间人收到，用会话密钥（中）进行解密，拿到数据 XXX 后进行篡改，得到数据 YYY。接着用会话密钥（客）对数据 YYY 进行加密，发送给客户端</li> <li>客户端收到数据 YYY，用会话密钥（客）加密数据 ZZZ，发给中间人</li> <li>中间人收到，用会话密钥（客）进行解密，拿到数据 ZZZ 后进行篡改，得到数据 WWW。接着用会话密钥（中）对数据 WWW 进行加密，发送给服务端</li> <li>服务端收到，用会话密钥（中）解密，拿到数据 WWW</li> <li>……</li></ul> <p>可以看到，中间人在客户端面前表现为服务端，在服务端面前又表现为客户端，两边来回劫持和篡改数据。下面的图更加清晰地展示了整个过程：</p> <img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/%E5%85%B3%E4%BA%8E%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/17.jpg" style="zoom:67%;"> <h2 id="dns-污染和劫持"><a href="#dns-污染和劫持" class="header-anchor">#</a> DNS 污染和劫持</h2> <h3 id="dns-劫持"><a href="#dns-劫持" class="header-anchor">#</a> DNS 劫持</h3> <p>DNS 劫持指的是劫持 DNS 服务器，获得对于某个域名的解析记录控制权，进而修改该域名的解析结果，返回一个错误的 IP 地址给客户端。DNS 劫持篡改的是 DNS 服务器上的数据，会导致用户无法访问某个网站，或者访问了一个假的克隆网站，从而导致个人信息泄露等。</p> <p><strong>案例</strong>：访问谷歌但是打开的是百度</p> <p><strong>解决方案</strong>：既然问题是出在 DNS 服务器，那么可以考虑手动更换 DNS 服务器为公共 DNS</p> <h3 id="dns-污染"><a href="#dns-污染" class="header-anchor">#</a> DNS 污染</h3> <p>DNS 污染属于 DNS 缓存投毒攻击，它把自己伪装成 DNS 服务器，将用户访问的域名指向不正确的 IP 地址然后返回。</p> <p><strong>案例：</strong> GFW 导致无法访问国外网站</p> <p><strong>解决方案：</strong> VPN 等</p> <h2 id="http-劫持"><a href="#http-劫持" class="header-anchor">#</a> HTTP 劫持</h2> <p>发起 HTTP 劫持的可能是第三方运营商、局域网或者免费公共 Wi-Fi 等，发生的原因在于流量必须经过运营商、局域网、Wi-Fi 等，而 HTTP 本身又是明文传输的，这就给了它们对数据进行劫持和篡改的机会。</p> <p>我们有时候在浏览某些网站的时候，经常会看到右下角有弹窗广告，实际上这不一定是网站本身投放的广告，往往是运营商进行 HTTP 劫持之后投放的。解决的方法也很简单，就是使用加密的 HTTPS。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/Vuepress-Frontend-Learning/WebSecurity/CrossDomain.html" class="prev">
            跨域通信
          </a></span> <span class="next"><a href="/Vuepress-Frontend-Learning/Performance/Performance.html">
            Web 性能优化
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#跨域和跨站的区别" class="sidebar-link reco-side-跨域和跨站的区别" data-v-cb1513f6>跨域和跨站的区别</a></li><li class="level-3" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#跨域" class="sidebar-link reco-side-跨域" data-v-cb1513f6>跨域</a></li><li class="level-3" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#跨站" class="sidebar-link reco-side-跨站" data-v-cb1513f6>跨站</a></li><li class="level-2" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#xss" class="sidebar-link reco-side-xss" data-v-cb1513f6>XSS</a></li><li class="level-3" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#分类" class="sidebar-link reco-side-分类" data-v-cb1513f6>分类</a></li><li class="level-3" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#防御措施" class="sidebar-link reco-side-防御措施" data-v-cb1513f6>防御措施</a></li><li class="level-2" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#csrf" class="sidebar-link reco-side-csrf" data-v-cb1513f6>CSRF</a></li><li class="level-3" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#案例" class="sidebar-link reco-side-案例" data-v-cb1513f6>案例</a></li><li class="level-3" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#xss-csrf" class="sidebar-link reco-side-xss-csrf" data-v-cb1513f6>XSS + CSRF</a></li><li class="level-3" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#防御措施-2" class="sidebar-link reco-side-防御措施-2" data-v-cb1513f6>防御措施</a></li><li class="level-2" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#clickjacking" class="sidebar-link reco-side-clickjacking" data-v-cb1513f6>ClickJacking</a></li><li class="level-3" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#防御措施-3" class="sidebar-link reco-side-防御措施-3" data-v-cb1513f6>防御措施</a></li><li class="level-2" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#中间人攻击" class="sidebar-link reco-side-中间人攻击" data-v-cb1513f6>中间人攻击</a></li><li class="level-2" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#dns-污染和劫持" class="sidebar-link reco-side-dns-污染和劫持" data-v-cb1513f6>DNS 污染和劫持</a></li><li class="level-3" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#dns-劫持" class="sidebar-link reco-side-dns-劫持" data-v-cb1513f6>DNS 劫持</a></li><li class="level-3" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#dns-污染" class="sidebar-link reco-side-dns-污染" data-v-cb1513f6>DNS 污染</a></li><li class="level-2" data-v-cb1513f6><a href="/Vuepress-Frontend-Learning/WebSecurity/WebSecurity.html#http-劫持" class="sidebar-link reco-side-http-劫持" data-v-cb1513f6>HTTP 劫持</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/Vuepress-Frontend-Learning/assets/js/app.124d66d7.js" defer></script><script src="/Vuepress-Frontend-Learning/assets/js/3.d90bb6d0.js" defer></script><script src="/Vuepress-Frontend-Learning/assets/js/1.2c4ca2ac.js" defer></script><script src="/Vuepress-Frontend-Learning/assets/js/81.b9714d74.js" defer></script>
  </body>
</html>
